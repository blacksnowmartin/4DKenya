<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>4DKenya | Advanced Network Monitor</title>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; background: linear-gradient(135deg, #000 0%, #0a0a15 50%, #000 100%); color: #00ffcc; font-family: 'Courier New', monospace; overflow: hidden; }
        
        #hud { 
            position: fixed; top: 20px; left: 20px; z-index: 10; 
            background: linear-gradient(135deg, rgba(0, 20, 0, 0.95), rgba(0, 30, 20, 0.95)); 
            border: 3px solid #00ffcc; padding: 25px; width: 450px;
            max-height: 80vh; overflow-y: auto;
            box-shadow: 0 0 30px rgba(0, 255, 204, 0.5), inset 0 0 20px rgba(0, 255, 204, 0.1);
            border-radius: 8px;
        }

        h1 { font-size: 20px; margin: 0 0 15px 0; border-bottom: 3px solid; border-image: linear-gradient(90deg, #00ffcc, #00ff88, #ffff00) 1; padding-bottom: 10px; text-shadow: 0 0 10px #00ffcc; }
        h2 { font-size: 13px; margin: 15px 0 8px 0; color: #ffff00; text-transform: uppercase; letter-spacing: 2px; text-shadow: 0 0 5px #ffff00; }
        
        .data-row { 
            display: flex; justify-content: space-between; margin-bottom: 8px; 
            font-size: 13px; border-bottom: 2px solid; border-image: linear-gradient(90deg, #00ffcc, transparent) 1; 
            padding-bottom: 3px;
        }
        .data-value { color: #ffff00; font-weight: bold; text-shadow: 0 0 5px #ffff00; }
        
        .bar-container { 
            width: 100%; height: 16px; background: linear-gradient(90deg, #1a1a2e, #0f3460); 
            margin: 10px 0; border: 2px solid #00ffcc; position: relative; overflow: hidden; border-radius: 4px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.8), 0 0 15px rgba(0, 255, 204, 0.3);
        }
        
        .bar-fill { 
            height: 100%; background: linear-gradient(90deg, #ff00ff, #00ffff, #00ff88, #ffff00); 
            transition: width 0.3s ease-out; text-align: right; font-size: 10px; line-height: 16px; 
            padding-right: 5px; font-weight: bold; color: #000; text-shadow: 0 0 3px #000;
            box-shadow: 0 0 20px rgba(0, 255, 204, 0.6);
        }

        .metric-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 12px 0; }
        .metric-box { 
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(255, 0, 255, 0.05)); 
            border: 2px solid #00ff88; padding: 12px; border-radius: 6px;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.3), inset 0 0 10px rgba(0, 255, 136, 0.05);
        }
        .metric-label { font-size: 11px; color: #00ff88; text-transform: uppercase; letter-spacing: 1px; }
        .metric-value { font-size: 16px; color: #ffff00; font-weight: bold; text-shadow: 0 0 5px #ffff00; margin-top: 4px; }

        .threat-indicator {
            display: inline-block; width: 14px; height: 14px; border-radius: 50%; margin-right: 6px;
            border: 2px solid;
        }
        .threat-active { background: #ff0000; box-shadow: 0 0 15px #ff0000, inset 0 0 10px #ff3333; border-color: #ffaa00; }
        .threat-clear { background: #00ff88; box-shadow: 0 0 15px #00ff88, inset 0 0 10px #33ff99; border-color: #00ffcc; }

        .protocol-list { font-size: 12px; max-height: 150px; overflow-y: auto; }
        .protocol-item { 
            margin-bottom: 5px; padding: 5px 8px; border-left: 3px solid; border-radius: 3px;
            background: linear-gradient(90deg, rgba(0, 255, 136, 0.1), transparent);
            border-image: linear-gradient(90deg, #ff00ff, #00ffff) 1;
        }
        
        .control-buttons { 
            display: flex; gap: 12px; margin-top: 15px; 
        }
        button { 
            flex: 1; padding: 12px; background: linear-gradient(135deg, #002233, #003355); 
            color: #00ffcc; border: 2px solid #00ffcc; cursor: pointer; font-weight: bold; 
            border-radius: 5px; transition: 0.4s; font-size: 12px; text-transform: uppercase;
            box-shadow: 0 0 10px rgba(0, 255, 204, 0.3);
        }
        button:hover { 
            background: linear-gradient(135deg, #00ffcc, #00ff88); 
            color: #000; box-shadow: 0 0 25px rgba(0, 255, 204, 0.8);
            transform: scale(1.05);
        }
        button.danger { 
            background: linear-gradient(135deg, #330000, #550000); 
            border-color: #ff4444; color: #ff6666;
            box-shadow: 0 0 10px rgba(255, 68, 68, 0.3);
        }
        button.danger:hover { 
            background: linear-gradient(135deg, #ff4444, #ff0000); 
            color: #000; box-shadow: 0 0 25px rgba(255, 68, 68, 0.8);
        }

        #analytics-panel {
            position: fixed; top: 20px; right: 20px; z-index: 10;
            background: linear-gradient(135deg, rgba(0, 30, 20, 0.95), rgba(0, 20, 0, 0.95)); 
            border: 3px solid #00ff88; padding: 25px; width: 400px;
            max-height: 80vh; overflow-y: auto;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.5), inset 0 0 20px rgba(0, 255, 136, 0.1);
            border-radius: 8px;
        }

        #analytics-panel h2 { color: #ffff00; border-image: linear-gradient(90deg, #ffff00, #00ffff) 1; border-bottom: 3px solid; padding-bottom: 8px; }

        .scrollbar::-webkit-scrollbar { width: 8px; }
        .scrollbar::-webkit-scrollbar-track { background: linear-gradient(180deg, rgba(0, 255, 204, 0.1), rgba(255, 0, 255, 0.1)); border-radius: 4px; }
        .scrollbar::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #00ffcc, #ff00ff); border-radius: 4px; box-shadow: 0 0 10px rgba(0, 255, 204, 0.5); }

        #hud { class: scrollbar; }
        #analytics-panel { class: scrollbar; }

        /* Animated gradient background */
        @keyframes gradientShift {
            0% { background: linear-gradient(135deg, #000 0%, #0a0a15 50%, #000 100%); }
            50% { background: linear-gradient(135deg, #0a0a15 0%, #000 50%, #0a1515 100%); }
            100% { background: linear-gradient(135deg, #000 0%, #0a0a15 50%, #000 100%); }
        }

        body {
            animation: gradientShift 8s ease-in-out infinite;
        }

        /* Pulsing glow effect */
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 30px rgba(0, 255, 204, 0.5), inset 0 0 20px rgba(0, 255, 204, 0.1); }
            50% { box-shadow: 0 0 50px rgba(0, 255, 204, 0.8), inset 0 0 20px rgba(0, 255, 204, 0.2); }
        }

        #hud { animation: pulse 3s ease-in-out infinite; }
        #analytics-panel { animation: pulse 3.5s ease-in-out infinite; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>

    <div id="hud" class="scrollbar">
        <h1>üì° Advanced Network Monitor</h1>
        
        <div class="data-row">
            <span>CONNECTION:</span> 
            <span id="conn-status" class="data-value" style="color:red">OFFLINE</span>
        </div>
        <div class="data-row">
            <span>NETWORK STATUS:</span> 
            <span id="status-text" class="data-value">WAITING...</span>
        </div>

        <h2>Health Metrics</h2>
        <div class="data-row">
            <span>HEALTH:</span>
            <span id="health-val" class="data-value">0%</span>
        </div>
        <div class="bar-container">
            <div class="bar-fill" id="health-bar" style="width: 0%"></div>
        </div>

        <div class="metric-grid">
            <div class="metric-box">
                <div class="metric-label">LATENCY</div>
                <div class="metric-value" id="latency-val">0ms</div>
            </div>
            <div class="metric-box">
                <div class="metric-label">THROUGHPUT</div>
                <div class="metric-value" id="throughput-val">0 KB/s</div>
            </div>
            <div class="metric-box">
                <div class="metric-label">JITTER</div>
                <div class="metric-value" id="jitter-val">0ms</div>
            </div>
            <div class="metric-box">
                <div class="metric-label">PACKET LOSS</div>
                <div class="metric-value" id="loss-val">0%</div>
            </div>
        </div>

        <h2>Threat Level</h2>
        <div class="data-row">
            <span>ANOMALY:</span>
            <span class="threat-indicator" id="threat-indicator"></span>
            <span id="anomaly-val" class="data-value">0.00</span>
        </div>
        <div class="bar-container">
            <div class="bar-fill" id="anomaly-bar" style="width: 0%; background: linear-gradient(90deg, #ff6600, #ff0000);"></div>
        </div>

        <h2>Active Threats</h2>
        <div id="threats-list" style="font-size: 11px; color: #ff6600; min-height: 30px;">
            <span style="color: #666;">No threats detected</span>
        </div>

        <h2>Protocol Distribution</h2>
        <div class="protocol-list" id="protocol-list"></div>

        <div class="control-buttons">
            <button onclick="triggerDDoS()">‚ö†Ô∏è SIM DDoS</button>
            <button onclick="stopAttack()">‚úì STOP</button>
        </div>
    </div>

    <div id="analytics-panel" class="scrollbar">
        <h2>üìä Live Analytics</h2>
        
        <div class="data-row">
            <span>ACTIVE CONNECTIONS:</span>
            <span id="connections-val" class="data-value">0</span>
        </div>
        <div class="data-row">
            <span>CONGESTION:</span>
            <span id="congestion-val" class="data-value">0%</span>
        </div>
        <div class="bar-container">
            <div class="bar-fill" id="congestion-bar" style="width: 0%"></div>
        </div>

        <div class="data-row">
            <span>THREATS DETECTED:</span>
            <span id="threat-count" class="data-value">0</span>
        </div>
        <div class="data-row">
            <span>DDoS ACTIVE:</span>
            <span id="ddos-status" class="data-value" style="color: #00ff88;">NO</span>
        </div>

        <h2>üîç Network Snapshot</h2>
        <div id="network-snapshot" style="font-size: 10px; background: rgba(0, 0, 0, 0.5); padding: 10px; border-radius: 3px; max-height: 300px; overflow-y: auto;">
            <span style="color: #666;">Waiting for data...</span>
        </div>
    </div>

    <script>
        const state = {
            time: 0,
            lastData: null,
            history: [],
            refreshRate: 0.1
        };

        // --- THREE.JS SETUP ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        camera.position.z = 4;

        // --- ADVANCED VISUALIZATION: DUAL CUBE SYSTEM ---
        const createCube = (size, color) => {
            const geo = new THREE.BoxGeometry(size, size, size);
            const edges = new THREE.EdgesGeometry(geo);
            const mat = new THREE.LineBasicMaterial({ color, linewidth: 2 });
            return new THREE.LineSegments(edges, mat);
        };

        const mainCube = createCube(1.5, 0x00ffcc);
        const innerCube = createCube(0.8, 0x00ffcc);
        const threatCube = createCube(2.5, 0xff0000);
        
        mainCube.add(innerCube);
        scene.add(mainCube);
        scene.add(threatCube);

        // Particle system for network packets
        const particleCount = 300;
        const particleGeo = new THREE.BufferGeometry();
        const positions = new Float32Array(particleCount * 3);
        for (let i = 0; i < particleCount * 3; i += 3) {
            positions[i] = (Math.random() - 0.5) * 8;
            positions[i + 1] = (Math.random() - 0.5) * 8;
            positions[i + 2] = (Math.random() - 0.5) * 8;
        }
        particleGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        const particleMat = new THREE.PointsMaterial({ color: 0x00ff88, size: 0.03, transparent: true, opacity: 0.6 });
        const particles = new THREE.Points(particleGeo, particleMat);
        scene.add(particles);

        const API_URL = "http://localhost:8000";

        async function triggerDDoS() {
            try {
                await fetch(`${API_URL}/trigger_ddos`, { method: 'POST' });
            } catch (e) {
                console.error("Error:", e);
            }
        }

        async function stopAttack() {
            try {
                await fetch(`${API_URL}/stop_attack`, { method: 'POST' });
            } catch (e) {
                console.error("Error:", e);
            }
        }

        async function updateDisplay() {
            try {
                const response = await fetch(`${API_URL}/network_pulse?time=${state.time}`);
                const data = await response.json();
                state.lastData = data;
                state.history.push(data);
                if (state.history.length > 100) state.history.shift();

                // Update main HUD with colorful display
                document.getElementById('conn-status').innerText = "CONNECTED";
                document.getElementById('conn-status').style.color = "#00ff88";
                document.getElementById('conn-status').style.textShadow = "0 0 10px #00ff88";
                document.getElementById('status-text').innerText = data.status;
                document.getElementById('status-text').style.color = data.color;
                document.getElementById('status-text').style.textShadow = `0 0 10px ${data.color}`;
                
                // Health display with dynamic coloring
                document.getElementById('health-val').innerText = data.health.toFixed(1) + "%";
                const healthColor = data.health > 70 ? "#00ff88" : data.health > 40 ? "#ffff00" : "#ff0000";
                document.getElementById('health-val').style.color = healthColor;
                document.getElementById('health-val').style.textShadow = `0 0 5px ${healthColor}`;
                
                document.getElementById('health-bar').style.width = data.health + "%";
                const healthGradient = data.health > 70 ? "linear-gradient(90deg, #00ff88, #00ffcc)" : 
                                       data.health > 40 ? "linear-gradient(90deg, #ffff00, #ff6600)" :
                                       "linear-gradient(90deg, #ff6600, #ff0000)";
                document.getElementById('health-bar').style.background = healthGradient;

                // Metrics with colorful values
                document.getElementById('latency-val').innerText = data.latency.toFixed(1) + "ms";
                document.getElementById('latency-val').style.color = data.latency > 30 ? "#ff6600" : "#00ffcc";
                document.getElementById('latency-val').style.textShadow = `0 0 5px ${data.latency > 30 ? "#ff6600" : "#00ffcc"}`;
                
                document.getElementById('throughput-val').innerText = data.throughput.toFixed(1) + " KB/s";
                document.getElementById('throughput-val').style.color = "#ffff00";
                document.getElementById('throughput-val').style.textShadow = "0 0 5px #ffff00";
                
                document.getElementById('jitter-val').innerText = data.jitter.toFixed(1) + "ms";
                document.getElementById('jitter-val').style.color = data.jitter > 3 ? "#ff00ff" : "#00ff88";
                document.getElementById('jitter-val').style.textShadow = `0 0 5px ${data.jitter > 3 ? "#ff00ff" : "#00ff88"}`;
                
                document.getElementById('loss-val').innerText = (data.loss_rate * 100).toFixed(2) + "%";
                document.getElementById('loss-val').style.color = data.loss_rate > 0.01 ? "#ff0000" : "#00ffcc";
                document.getElementById('loss-val').style.textShadow = `0 0 5px ${data.loss_rate > 0.01 ? "#ff0000" : "#00ffcc"}`;

                // Threat indicator with animation
                const indicator = document.getElementById('threat-indicator');
                indicator.className = "threat-indicator " + (data.threat_count > 0 ? "threat-active" : "threat-clear");
                document.getElementById('anomaly-val').innerText = data.anomaly_score.toFixed(3);
                const anomalyColor = data.anomaly_score > 0.6 ? "#ff0000" : data.anomaly_score > 0.3 ? "#ffff00" : "#00ff88";
                document.getElementById('anomaly-val').style.color = anomalyColor;
                document.getElementById('anomaly-val').style.textShadow = `0 0 5px ${anomalyColor}`;
                
                document.getElementById('anomaly-bar').style.width = (data.anomaly_score * 100) + "%";
                document.getElementById('anomaly-bar').style.background = data.anomaly_score > 0.6 ? "linear-gradient(90deg, #ff0000, #ff6666)" :
                                                                          data.anomaly_score > 0.3 ? "linear-gradient(90deg, #ffff00, #ff6600)" :
                                                                          "linear-gradient(90deg, #00ff88, #00ffcc)";

                // Threats display with colors
                const threatsList = document.getElementById('threats-list');
                if (data.threat_count > 0) {
                    threatsList.innerHTML = `<span style="color: #ff0000; text-shadow: 0 0 10px #ff0000;">‚ö†Ô∏è ${data.threat_count} THREAT(S) DETECTED</span>`;
                } else {
                    threatsList.innerHTML = `<span style="color: #00ff88; text-shadow: 0 0 5px #00ff88;">‚úì All Clear</span>`;
                }

                // Protocol distribution with colors
                const protocolList = document.getElementById('protocol-list');
                let html = '';
                const colors = ['#00ffcc', '#ff00ff', '#ffff00', '#00ff88', '#ff6600'];
                let colorIdx = 0;
                for (const [proto, count] of Object.entries(data.protocol_distribution || {})) {
                    const percent = (count / (data.active_connections || 1) * 100).toFixed(1);
                    const color = colors[colorIdx % colors.length];
                    html += `<div class="protocol-item" style="border-left-color: ${color}; color: ${color}; text-shadow: 0 0 5px ${color};">${proto}: ${count} (${percent}%)</div>`;
                    colorIdx++;
                }
                protocolList.innerHTML = html || '<span style="color: #666;">No data</span>';

                // Analytics panel updates with colors
                document.getElementById('connections-val').innerText = data.active_connections;
                document.getElementById('connections-val').style.color = "#ffff00";
                
                document.getElementById('congestion-val').innerText = (data.congestion * 100).toFixed(1) + "%";
                const congestionColor = data.congestion > 0.7 ? "#ff0000" : "#00ffcc";
                document.getElementById('congestion-val').style.color = congestionColor;
                document.getElementById('congestion-val').style.textShadow = `0 0 5px ${congestionColor}`;
                
                document.getElementById('congestion-bar').style.width = (data.congestion * 100) + "%";
                document.getElementById('congestion-bar').style.background = data.congestion > 0.7 ? "linear-gradient(90deg, #ff0000, #ff6666)" :
                                                                            "linear-gradient(90deg, #00ff88, #ffff00)";
                
                document.getElementById('threat-count').innerText = data.threat_count;
                document.getElementById('threat-count').style.color = data.threat_count > 0 ? "#ff0000" : "#00ff88";
                document.getElementById('threat-count').style.textShadow = `0 0 5px ${data.threat_count > 0 ? "#ff0000" : "#00ff88"}`;
                
                document.getElementById('ddos-status').innerText = data.load > 0.5 ? "YES" : "NO";
                document.getElementById('ddos-status').style.color = data.load > 0.5 ? "#ff0000" : "#00ff88";
                document.getElementById('ddos-status').style.textShadow = data.load > 0.5 ? "0 0 10px #ff0000" : "0 0 5px #00ff88";

                // Update visualization
                mainCube.material.color.set(data.color);
                innerCube.material.color.set(data.color);
                threatCube.material.opacity = Math.max(0.2, data.anomaly_score);

                const speed = 0.01 + (data.load * 0.08);
                mainCube.rotation.x += speed;
                mainCube.rotation.y += speed;
                threatCube.rotation.x -= speed * 0.5;
                threatCube.rotation.y -= speed * 0.5;

                const scale = 1 + (data.load * 0.3);
                mainCube.scale.set(scale, scale, scale);

                // Update particles based on throughput
                const pos = particles.geometry.attributes.position.array;
                for (let i = 0; i < pos.length; i += 3) {
                    pos[i] += Math.sin(state.time + i) * data.throughput * 0.001;
                    pos[i + 1] += Math.cos(state.time + i) * data.throughput * 0.001;
                    pos[i + 2] += (Math.random() - 0.5) * data.anomaly_score * 0.1;
                }
                particles.geometry.attributes.position.needsUpdate = true;

            } catch (error) {
                document.getElementById('conn-status').innerText = "CONNECTION LOST";
                document.getElementById('conn-status').style.color = "#ff0000";
                document.getElementById('conn-status').style.textShadow = "0 0 10px #ff0000";
            }

            state.time += state.refreshRate;
        }

        async function animate() {
            requestAnimationFrame(animate);
            await updateDisplay();
            scene.rotation.z += 0.0005;
            particles.rotation.z += 0.003;
            renderer.render(scene, camera);
        }

        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>

</body>
</html>